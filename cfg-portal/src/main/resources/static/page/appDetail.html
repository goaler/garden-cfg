<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title>CFG配置中心</title>
	<script src="../js/vue.js"></script>

	<link rel="stylesheet" href="../css/common-style.css">
	<link rel="stylesheet" href="../css/animate.css">
	<link rel="stylesheet" href="../css/layui.css">

	<style>
		.info-panel {
			/* border: solid 1px rgb(168, 157, 157); */
			position: absolute;
			width: 250px;
		}

		.config-panel {
			/* border: solid 1px rgb(168, 157, 157); */
			margin-left: 255px;
			min-width:900px;
		}

		.info-item {
			margin: 20px;
			padding: 15px;
			background-color: rgb(187, 244, 248);
			border: solid 1px #ddd;
		}

		.info-item div {
			/* font-size: 15px; */
			overflow: hidden;
			text-overflow: ellipsis;
		}

		.item-title {
			font-weight: bold;
			font-size: 18px;
			padding-bottom: 10px;
		}

		.menu {
			list-style: none;
			padding: 0px 20px;
			margin: 0px;
			border-top: 1px solid #ddd;
			border-bottom: 1px solid #ddd;
		}

		.menu-item {
			display:inline-block;
			cursor: pointer;
			padding: 10px 35px;
			margin: 0px 5px;
		}

		.menu-item:hover {
			background-color: #608ebe;
		}

		[v-cloak] {
			display: none;
		}
	</style>
</head>

<body>
	<div id="body-panel">
	<div>
		<h1>主页</h1>
	</div>
	<div>
		<div id="info" class="info-panel" v-cloak>
			<transition name="custom-classes-transition" enter-active-class="animated tada" leave-active-class="animated bounceOutRight">
				<div v-show="show" class="info-item">
					<div class="item-title">项目信息</div>
					<div v-bind:title="app.name">项目名称：{{app.name}}</div>
					<div v-bind:title="app.code">项目编号：{{app.code}}</div>
					<div v-bind:title="app.comment">项目描述：{{app.comment}}</div>
				</div>
			</transition>
			<transition name="custom-classes-transition" enter-active-class="animated tada" leave-active-class="animated bounceOutRight">
				<div v-show="show" class="info-item">
					<div class="item-title">所属环境</div>
					<select v-model="currentEnv">
						<option v-for="env in envs" v-bind:value="env.envCode">{{ env.envName }}({{env.envCode}})</option>
					</select>
				</div>
			</transition>
			<transition name="custom-classes-transition" enter-active-class="animated tada" leave-active-class="animated bounceOutRight">
				<div v-show="show" class="info-item">
					<div class="item-title">所属集群</div>
					<select v-model="currentCluster">
						<option v-for="cluster in clusters" v-bind:value="cluster.clusterCode">{{ cluster.clusterName }}({{cluster.clusterCode}})
						</option>
					</select>
				</div>
			</transition>
		</div>
		<div id="config" class="config-panel" v-cloak>
			<h4>配置管理</h4>
			<ul class="menu">
				<li v-on:click="editorType='table'" class="menu-item">列表</li>
				<li v-on:click="editorType='text'" class="menu-item">文本</li>		
			</ul>
			<div style="height: 200px">
				<div v-show="editorType == 'text'">
					<text-editor v-model="content"></text-editor>
				</div>
				<div v-show="editorType == 'table'">
					<table class="layui-table" lay-even="" lay-skin="row">
						<thead>
							<tr>
								<th>人物</th>
								<th>民族</th>
								<th>出场时间</th>
								<th>格言</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>贤心</td>
								<td>汉族</td>
								<td>1989-10-14</td>
								<td>人生似修行</td>
							</tr>
							<tr>
								<td>张爱玲</td>
								<td>汉族</td>
								<td>1920-09-30</td>
								<td>于千万人之中遇见你所遇见的人，于千万年之中，时间的无涯的荒野里…</td>
							</tr>
							<tr>
								<td>Helen Keller</td>
								<td>拉丁美裔</td>
								<td>1880-06-27</td>
								<td> Life is either a daring adventure or nothing.</td>
							</tr>
							<tr>
								<td>岳飞</td>
								<td>汉族</td>
								<td>1103-北宋崇宁二年</td>
								<td>教科书再滥改，也抹不去“民族英雄”的事实</td>
							</tr>
							<tr>
								<td>孟子</td>
								<td>华夏族（汉族）</td>
								<td>公元前-372年</td>
								<td>猿强，则国强。国强，则猿更强！ </td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>
	</div>

	<script src="../js/axios.js"></script>
	<script src="../js/ace.js"></script>
	<script src="../js/mode-properties.js"></script>
	<script src="../js/theme-iplastic.js"></script>
	<script src="../js/app.js"></script>
	<template id="template-editor">
		<div id="editor" class="form-control" style="height: 400px">
		</div>
	</template>
	<script>
		Vue.component('text-editor', {
			props: {
				value: null
			},
			data: function () {
				return {
					editor: null
				}
			},
			mounted: function () {
				this.configTextEditor()
			},
			methods: {
				configTextEditor: function () {
					var vm = this
					editor = ace.edit("editor")
					editor.$blockScrolling = Infinity
					editor.setFontSize(16)
					editor.setTheme("ace/theme/iplastic")
					editor.session.setMode("ace/mode/properties")
					editor.setOptions({
						enableBasicAutocompletion: true,
						enableSnippets: true,
						enableLiveAutocompletion: true
					})
					editor.on('change', function () {
						vm.$emit('input', editor.getValue());
					});
				}
			},
			watch: {
				value: function (newVal, oldVal) {
					if (newVal != editor.getValue()) {
						editor.setValue(newVal, 1)
					}
				}
			},
			template: '#template-editor'
		})
	</script>
	<script>
		new Vue({
			el: '#config',
			data: {
				editorType: "table",
				props: [],
				content: ""

			},
			mounted: function () {
				this.fetchProps()
			},
			methods: {
				fetchProps: function () {
					this.props = [{
						key: "name",
						value: "yy123"
					}]
					var ret = ""
					if (this.props && this.props.length > 0) {
						for (let p of this.props) {
							ret += p.key + " = " + p.value + "\r\n"
						}
					}
					this.content = ret
				}
			}

		})

		new Vue({
			el: '#info',
			data: {
				show: false,
				app: {
					name: '',
					code: '',
					comment: ''
				},
				currentEnv: '',
				envs: [{
					envCode: '',
					envName: ''
				}],
				currentCluster: '',
				clusters: [{
					clusterCode: '',
					clusterName: ''
				}]
			},
			mounted: function () {
				this.initPage()
				this.getAppInfo()
				this.findEnvs()
				this.findClusters()
			},
			methods: {
				initPage: function () {
					document.title += "-" + getUrlKey("appCode")
					this.show = true
				},
				getAppInfo() {
					axios
						.get('/app/info' + window.location.search)
						.then(resp => {
							if (resp.data) {
								this.app = resp.data
							}
						})
				},
				findEnvs() {
					axios
						.get('/env/list')
						.then(resp => {
							if (resp.data) {
								this.envs = resp.data
								this.currentEnv = this.envs[0].envCode
							}
						})
				},
				findClusters() {
					axios
						.get('/cluster/list')
						.then(resp => {
							if (resp.data) {
								this.clusters = resp.data
								this.currentCluster = this.clusters[0].clusterCode
							}
						})
				}
			}
		})
	</script>
</body>

</html>